<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        canvas {
      background: #f0f0f0;
      display: block;
      margin: 20px auto;
      max-width: 90vw;
      height: auto;
    }
    button {
      display: block;
      margin: 10px auto;
      padding: 10px 20px;
      font-size: 16px;
    }
    </style>

</head>
<body>
  <script>
         const NUM_PETALS = 20;

    for (let i = 0; i < NUM_PETALS; i++) {
      const petal = document.createElement("div");
      petal.innerText = "ğŸŒ¸";

      // åˆæœŸä½ç½®ãƒ»è¦‹ãŸç›®ã®è¨­å®š
      petal.style.position = "fixed";
      petal.style.left = Math.random() * window.innerWidth + "px";
      petal.style.top = Math.random() * -window.innerHeight + "px";
      petal.style.fontSize = (Math.random() * 10 + 18) + "px";
      petal.style.opacity = Math.random() * 0.8 + 0.2;
      petal.style.pointerEvents = "none";
      petal.style.zIndex = "9999";

      document.body.appendChild(petal);

      // å‹•ãã‚’ã¤ã‘ã‚‹
      let x = parseFloat(petal.style.left);
      let y = parseFloat(petal.style.top);
      let speedY = Math.random() * 1 + 0.5;
      let angle = Math.random() * 360;

      setInterval(() => {
        y += speedY;
        x += Math.sin((y + i * 10) / 50) * 1.5;
        angle += 1;

        if (y > window.innerHeight) {
          y = -50;
          x = Math.random() * window.innerWidth;
        }

        petal.style.left = x + "px";
        petal.style.top = y + "px";
        petal.style.transform = `rotate(${angle}deg)`;
      }, 30);
    }
    </script>
<canvas id="roulette"></canvas>
  <button id="startButton" onclick="startRoulette()">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>

  <script>
    const names = ["ã•ã¨ã‚‹ã•ã‚“", "ã‚‚ã¨ã‚†ãã•ã‚“", "ã¿ãŠã‚Šã•ã‚“", "ã‚†ããªã•ã‚“", "ã¯ã‚‹ãã•ã‚“", "ã¿ã‚Œã„", "ã“ã®ã‹ã•ã‚“"];
    const topics = [
      "å¥½ããªé£Ÿã¹ç‰©", "ãŠã™ã™ã‚ã®æœ¬", "æœ€è¿‘ã®ãƒã‚¤ãƒ–ãƒ¼ãƒ ", "ç†æƒ³ã®ä¼‘æ—¥",
      "å¥½ããªæ˜ ç”»ã¨ãã®ç†ç”±", "å°Šæ•¬ã™ã‚‹äººã«ã¤ã„ã¦", "æœ€è¿‘ç¬‘ã£ãŸã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰", "è¡Œã£ã¦ã¿ãŸã„å›½ã¨ç†ç”±",
      "ä»Šå¹´ã®ç›®æ¨™ã‚„æŠ±è² ", "éƒ¨æ´»ã®æ€ã„å‡ºã¨ä¸€è¨€"
    ];
    const canvas = document.getElementById('roulette');
    const ctx = canvas.getContext('2d');
    let center = 200;
    let innerAngle = 0;
    let outerAngle = 0;

    function resizeCanvas() {
      const size = Math.min(window.innerWidth * 0.9, 400);
      canvas.width = size;
      canvas.height = size;
      center = size / 2;
    }

    function drawMultilineText(text, x, y, maxWidth, lineHeight) {
      const chars = text.split('');
      let line = '';
      const lines = [];
      for (let i = 0; i < chars.length; i++) {
        const testLine = line + chars[i];
        if (ctx.measureText(testLine).width > maxWidth && line.length > 0) {
          lines.push(line);
          line = chars[i];
        } else {
          line = testLine;
        }
      }
      if (line) lines.push(line);
      lines.forEach((line, i) => ctx.fillText(line, x, y + i * lineHeight));
    }

    function drawRoulette(innerRot = 0, outerRot = 0) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const nameAnglePer = 2 * Math.PI / names.length;
      const topicAnglePer = 2 * Math.PI / topics.length;

      // å¤–å´ï¼ˆãŠé¡Œï¼‰
      for (let i = 0; i < topics.length; i++) {
        ctx.beginPath();
        ctx.moveTo(center, center);
        ctx.arc(center, center, center * 0.9, outerRot + i * topicAnglePer, outerRot + (i + 1) * topicAnglePer);
        ctx.fillStyle = `hsl(${i * (360 / topics.length)}, 60%, 90%)`;
        ctx.fill();
        ctx.save();
        ctx.translate(center, center);
        ctx.rotate(outerRot + (i + 0.5) * topicAnglePer);
        ctx.fillStyle = '#333';
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.font = `${center * 0.05}px sans-serif`;
        drawMultilineText(topics[i], center * 0.75, 0, center * 0.45, center * 0.055);
        ctx.restore();
      }

      // å†…å´ï¼ˆåå‰ï¼‰
      for (let i = 0; i < names.length; i++) {
        ctx.beginPath();
        ctx.moveTo(center, center);
        ctx.arc(center, center, center * 0.5, innerRot + i * nameAnglePer, innerRot + (i + 1) * nameAnglePer);
        ctx.fillStyle = `hsl(${(i * 360 / names.length + 180) % 360}, 40%, 85%)`;
        ctx.fill();
        ctx.save();
        ctx.translate(center, center);
        ctx.rotate(innerRot + (i + 0.5) * nameAnglePer);
        ctx.fillStyle = '#111';
        ctx.font = `${center * 0.09}px sans-serif`;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(names[i], center * 0.3, 0);
        ctx.restore();
      }

      // é‡
      ctx.beginPath();
      ctx.moveTo(center, center);
      ctx.lineTo(center, center * 0.05);
      ctx.strokeStyle = 'red';
      ctx.lineWidth = 3;
      ctx.stroke();
    }

    function startRoulette() {
      let speed1 = 0.3;
      let speed2 = 0.25;
      let angle1 = innerAngle;
      let angle2 = outerAngle;
      const nameIndex = 1;
      const topicIndex = 2;
      const nameAnglePer = 2 * Math.PI / names.length;
      const topicAnglePer = 2 * Math.PI / topics.length;
      const finalInner = -(2 * Math.PI * 5) - (2 * Math.PI - (nameIndex + 0.5) * nameAnglePer);
      const finalOuter = (2 * Math.PI * 4) + (2 * Math.PI - (topicIndex + 0.5) * topicAnglePer);

      const interval = setInterval(() => {
        angle1 -= speed1; // å†…å´ã‚’åæ™‚è¨ˆå›ã‚Š
        angle2 += speed2; // å¤–å´ã‚’æ™‚è¨ˆå›ã‚Š
        speed1 *= 0.98;
        speed2 *= 0.98;
        const done1 = speed1 < 0.01 && angle1 <= finalInner;
        const done2 = speed2 < 0.01 && angle2 >= finalOuter;

        if (done1 && done2) {
          clearInterval(interval);
          innerAngle = finalInner % (2 * Math.PI);
          outerAngle = finalOuter % (2 * Math.PI);
          drawRoulette(innerAngle, outerAngle);
        } else {
          drawRoulette(angle1, angle2);
        }
      }, 30);
    }

    window.addEventListener('resize', () => {
      resizeCanvas();
      drawRoulette(innerAngle, outerAngle);
    });

    resizeCanvas();
    drawRoulette();
  </script>
<p style="cursor: url(https://toyoryokutai.github.io/petal-demo/bud.cur), text;">
  ã“ã®æ®µè½ã«ã‚«ãƒ¼ã‚½ãƒ«ã‚’åˆã‚ã›ã‚‹ã¨ã€ã‚«ãƒ¼ã‚½ãƒ«ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚
</p>

</body>
</html>
